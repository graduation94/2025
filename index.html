<script>
document.addEventListener("DOMContentLoaded", () => {
  const input = document.getElementById("seat");
  const btn = document.getElementById("checkBtn");
  const resultDiv = document.getElementById("result");

  // helper: توحيد المقارنة حتى لو كان seat_number رقم أو نص
  const norm = v => (v ?? "").toString().trim();

  input.addEventListener("keypress", (e) => {
    if (e.key === "Enter") btn.click();
  });

  btn.addEventListener("click", async () => {
    const seat = norm(input.value);
    resultDiv.innerHTML = "";

    if (!seat) {
      resultDiv.innerHTML = `<div class="message">Please enter your seat number.</div>`;
      return;
    }

    resultDiv.innerHTML = `<div class="loader"></div>`;

    try {
      // تأكد أن orders.json بجانب index.html (نفس المجلد)
      const res = await fetch("./orders.json?nocache=" + Date.now());
      if (!res.ok) throw new Error(`Cannot load orders.json (status ${res.status})`);

      const data = await res.json();

      // لو seat_number في JSON أحيانًا رقم، نحوله لنص ونقارن كنص
      const student = data.find(x => norm(x.seat_number) === seat);

      if (!student) {
        resultDiv.innerHTML = `
          <div class="message">
            This website’s data was last updated on <b>Thursday at 11:00 PM</b>.<br>
            If your record doesn’t appear yet, please check back later.
          </div>`;
        return;
      }

      const isItems = student.order_type && student.order_type.toLowerCase().includes("item");

      if (isItems) {
        resultDiv.innerHTML = `
          <div class="result">
            <div class="order-type">Order Type: ${student.order_type || "-"}</div>
            <div class="size">Order Number: ${student.order || "-"}</div>
          </div>`;
      } else {
        resultDiv.innerHTML = `
          <div class="result">
            <div class="order-type">Order Type: ${student.order_type || "-"}</div>
            <div class="name">${student.name_on_robe || ""}</div>
            <div class="size">Size: ${student.size || "-"}</div>
            <div class="size">Order Number: ${student.order || "-"}</div>
          </div>`;
      }

      input.value = "";
    } catch (err) {
      console.error(err); // يساعدك لو فيه صفحة بيضاء
      resultDiv.innerHTML = `<div class="message">⚠️ Error loading data: ${err.message}</div>`;
    }
  });
});
</script>
