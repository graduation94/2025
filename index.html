<script>
document.addEventListener("DOMContentLoaded", () => {
  const input = document.getElementById("seat");
  const btn = document.getElementById("checkBtn");
  const resultDiv = document.getElementById("result");

  btn.addEventListener("click", async () => {
    const seat = input.value.trim();
    resultDiv.innerHTML = "";

    if (!seat) {
      resultDiv.innerHTML = `<div class="message">Please enter your seat number.</div>`;
      return;
    }

    resultDiv.innerHTML = `<div class="loader"></div>`;

    try {
      // ✅ هنا تم التعديل ليقرأ الملف orders.json
      const response = await fetch("orders.json?nocache=" + Date.now());
      if (!response.ok) throw new Error("File not found or inaccessible");

      const data = await response.json();
      const student = data.find(x => x.seat_number === seat);

      if (!student) {
        resultDiv.innerHTML = `
          <div class="message">
            This website’s data was last updated on <b>Thursday at 11:00 PM</b>.<br>
            If your record doesn’t appear yet, please check back later.
          </div>`;
        return;
      }

      const isItems = student.order_type && student.order_type.toLowerCase().includes("item");

      if (isItems) {
        resultDiv.innerHTML = `
          <div class="result">
            <div class="order-type">Order Type: ${student.order_type || "-"}</div>
            <div class="size">Order Number: ${student.order || "-"}</div>
          </div>`;
      } else {
        resultDiv.innerHTML = `
          <div class="result">
            <div class="order-type">Order Type: ${student.order_type || "-"}</div>
            <div class="name">${student.name_on_robe || ""}</div>
            <div class="size">Size: ${student.size || "-"}</div>
            <div class="size">Order Number: ${student.order || "-"}</div>
          </div>`;
      }

      input.value = "";
    } catch (error) {
      resultDiv.innerHTML = `<div class="message">⚠️ Error loading data: ${error.message}</div>`;
    }
  });

  input.addEventListener("keypress", (e) => {
    if (e.key === "Enter") btn.click();
  });
});
</script>
